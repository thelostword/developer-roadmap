import{h as m,p as $}from"./hooks.module.7cc4e70a.js";import{h as D,a as M}from"./http.82ebf0f1.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{u as P}from"./use-toast.fb52de5d.js";import{k as p}from"./preact.module.7b19fc78.js";import{p as u}from"./page.c1a8a472.js";import{R}from"./roadmap.e17ba5ff.js";import"./jwt.f0e0aa9c.js";import"./toast.1fe7142d.js";import"./index.a98c85f5.js";function x(n){const{text:s,count:i}=n;return e("div",{class:"relative flex flex-1 flex-row-reverse sm:flex-col px-0 sm:px-4 py-2 sm:py-4 text-center sm:pt-10 items-center gap-2 sm:gap-0 justify-end",children:[e("h2",{class:"text-base sm:text-5xl font-bold",children:i}),e("p",{class:"mt-0 sm:mt-2 text-sm text-gray-400",children:s})]})}function B(n){const{done:s,learning:i,streak:l}=n;return e("div",{class:"mx-0 -mt-5 sm:-mx-10 md:-mt-10",children:e("div",{class:"flex flex-col sm:flex-row gap-0 sm:gap-2 divide-y sm:divide-y-0 divide-x-0 sm:divide-x border-b",children:[e(x,{text:"Topics Completed",count:`${s?.total||0}`}),e(x,{text:"Currently Learning",count:`${i?.total||0}`}),e(x,{text:"Visit Streak",count:`${l?.count||0}d`})]})})}function S(n){if(!Intl?.RelativeTimeFormat)return n;const s=new Intl.RelativeTimeFormat("en",{numeric:"auto",style:"narrow"}),i=new Date,l=new Date(n),o=i.getTime()-l.getTime(),d=Math.round(o/(1e3*60)),a=Math.round(o/(1e3*60*60)),t=Math.round(o/(1e3*60*60*24));let r;return d<60?r=s.format(-d,"minute"):a<24?r=s.format(-a,"hour"):r=s.format(-t,"day"),r}function A(n){const{showClearButton:s=!0}=n,i=P(),[l,o]=m(!1),[d,a]=m(!1),{updatedAt:t,resourceType:r,resourceId:c,title:g,totalCount:y,learningCount:v,doneCount:h,skippedCount:f,onCleared:C}=n;async function w(){o(!0);const{error:b,response:N}=await D("https://api.roadmap.sh/v1-clear-resource-progress",{resourceId:c,resourceType:r});if(b||!N){i.error("Error clearing progress. Please try again."),console.error(b),o(!1);return}localStorage.removeItem(`${r}-${c}-favorite`),localStorage.removeItem(`${r}-${c}-progress`),o(!1),a(!1),C&&C()}const k=r==="roadmap"?`/${c}`:`/best-practices/${c}`,I=h+f,T=Math.round(I/y*100);return e("div",{children:[e("a",{href:k,className:"group relative flex cursor-pointer items-center rounded-t-md border p-3 text-gray-600 hover:border-gray-300 hover:text-black",children:[e("span",{className:"absolute left-0 top-0 block h-full cursor-pointer rounded-tl-md bg-black/5 group-hover:bg-black/10",style:{width:`${T}%`}}),e("span",{className:"relative  flex-1 cursor-pointer truncate",children:g}),e("span",{className:"ml-1 cursor-pointer text-sm text-gray-400",children:S(t)})]}),e("p",{className:"sm:space-between flex flex-row items-start rounded-b-md border border-t-0 px-2 py-2 text-xs text-gray-500",children:[e("span",{className:"hidden flex-1 gap-1 sm:flex",children:[h>0&&e(p,{children:[e("span",{children:[h," done"]})," •"]}),v>0&&e(p,{children:[e("span",{children:[v," in progress"]})," •"]}),f>0&&e(p,{children:[e("span",{children:[f," skipped"]})," •"]}),e("span",{children:[y," total"]})]}),s&&e(p,{children:[!d&&e("button",{className:"text-red-500 hover:text-red-800",onClick:()=>a(!0),disabled:l,children:[!l&&e(p,{children:["Clear Progress ",e("span",{children:"×"})]}),l&&"Processing..."]}),d&&e("span",{children:["Are you sure?"," ",e("button",{onClick:w,className:"ml-1 mr-1 text-red-500 underline hover:text-red-800",children:"Yes"})," ",e("button",{onClick:()=>a(!1),className:"text-red-500 underline hover:text-red-800",children:"No"})]})]})]})]})}function E(){return e("div",{class:"rounded-md",children:e("div",{class:"flex flex-col items-center p-7 text-center",children:[e("img",{alt:"no roadmaps",src:R,class:"mb-2 w-[60px] h-[60px] sm:h-[120px] sm:w-[120px] opacity-10"}),e("h2",{class:"text-lg sm:text-xl font-bold",children:"No Progress"}),e("p",{className:"my-1 sm:my-2 max-w-[400px] text-gray-500 text-sm sm:text-base",children:["Progress will appear here as you start tracking your"," ",e("a",{href:"/roadmaps",class:"mt-4 text-blue-500 hover:underline",children:"Roadmaps"})," ","or"," ",e("a",{href:"/best-practices",class:"mt-4 text-blue-500 hover:underline",children:"Best Practices"})," ","progress."]})]})})}function J(){const[n,s]=m(),[i,l]=m(!0);async function o(){const{error:t,response:r}=await M("https://api.roadmap.sh/v1-get-user-stats");if(!r||t){console.error("Error loading activity"),console.error(t);return}s(r)}$(()=>{o().finally(()=>{u.set(""),l(!1)})},[]);const d=n?.learning.roadmaps||[],a=n?.learning.bestPractices||[];return i?null:e(p,{children:[e(B,{done:n?.done||{today:0,total:0},learning:n?.learning||{today:0,total:0},streak:n?.streak||{count:0}}),e("div",{class:"mx-0 px-0 py-5 md:-mx-10 md:px-8 md:py-8",children:[d.length===0&&a.length===0&&e(E,{}),(d.length>0||a.length>0)&&e(p,{children:[e("h2",{class:"mb-3 text-xs uppercase text-gray-400",children:"Continue Following"}),e("div",{class:"flex flex-col gap-3",children:[d.sort((t,r)=>{const c=new Date(t.updatedAt);return new Date(r.updatedAt).getTime()-c.getTime()}).map(t=>e(A,{doneCount:t.done||0,learningCount:t.learning||0,totalCount:t.total||0,skippedCount:t.skipped||0,resourceId:t.id,resourceType:"roadmap",updatedAt:t.updatedAt,title:t.title,onCleared:()=>{u.set("Updating activity"),o().finally(()=>{u.set("")})}})),a.sort((t,r)=>{const c=new Date(t.updatedAt);return new Date(r.updatedAt).getTime()-c.getTime()}).map(t=>e(A,{doneCount:t.done||0,totalCount:t.total||0,learningCount:t.learning||0,resourceId:t.id,skippedCount:t.skipped||0,resourceType:"best-practice",title:t.title,updatedAt:t.updatedAt,onCleared:()=>{u.set("Updating activity"),o().finally(()=>{u.set("")})}}))]})]})]})]})}export{J as ActivityPage};
