import{a as d,T as p}from"./jwt.2bcbdb7f.js";import{a as l,h as f}from"./http.1ee0e3a2.js";async function E(r){const{topicId:n,resourceType:o,resourceId:t}=r,{done:s=[]}=await i(o,t)||{};return s?.includes(n)}async function y(r){const{topicId:n,resourceType:o,resourceId:t}=r,s=await i(o,t);return s?.done.includes(n)?"done":s?.learning.includes(n)?"learning":"pending"}async function $(r,n){const{topicId:o,resourceType:t,resourceId:s}=r,{response:e,error:a}=await f("https://api.roadmap.sh/v1-update-resource-progress",{topicId:o,resourceType:t,resourceId:s,progress:n});if(a||!e?.done||!e?.learning)throw new Error(a?.message||"Something went wrong");return u(t,s,e.done,e.learning),e}async function i(r,n){if(!d.get(p))return{done:[],learning:[]};const o=`${r}-${n}-progress`,t=localStorage.getItem(o),s=JSON.parse(t||"null"),e=s?.timestamp,c=new Date().getTime()-parseInt(e||"0",10)>15*60*1e3;return!s||c?h(r,n):s}async function h(r,n){const{response:o,error:t}=await l("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:r,resourceId:n});return t?(console.error(t),{done:[],learning:[]}):!o?.done||!o?.learning?{done:[],learning:[]}:(u(r,n,o.done,o.learning),o)}function u(r,n,o,t){localStorage.setItem(`${r}-${n}-progress`,JSON.stringify({done:o,learning:t,timestamp:new Date().getTime()}))}function g(r,n){const o=n==="learning",t=n==="done",s=[];document.querySelectorAll(`[data-group-id$="-${r}"]`).forEach(e=>{const a=e?.dataset?.groupId||"";new RegExp(`^\\d+-${r}$`).test(a)&&s.push(e)}),document.querySelectorAll(`[data-group-id="${r}"]`).forEach(e=>{s.push(e)}),document.querySelectorAll(`[data-group-id="check:${r}"]`).forEach(e=>{s.push(e)}),s.forEach(e=>{t?(e.classList.add("done"),e.classList.remove("learning")):o?(e.classList.add("learning"),e.classList.remove("done")):(e.classList.remove("done"),e.classList.remove("learning"))})}async function S(r,n){const{done:o=[],learning:t=[]}=await i(r,n)||{};o.forEach(s=>{g(s,"done")}),t.forEach(s=>{g(s,"learning")})}export{S as a,y as g,E as i,g as r,$ as u};
