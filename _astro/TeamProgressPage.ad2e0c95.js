import{_ as E,h as p,p as M}from"./hooks.module.7cc4e70a.js";import{u as U}from"./use-team-id.3d0ab368.js";import{a as _}from"./http.ae6f811c.js";import{p as z}from"./page.c1a8a472.js";import{D as B}from"./index.es.ebad3893.js";import{S as F}from"./Spinner.95905af5.js";/* empty css                       */import{u as V}from"./use-outside-click.85d1a62f.js";import{u as Y}from"./use-keydown.41d75069.js";import{r as T}from"./resource-progress.7a8a770c.js";import{C as q}from"./close.3a539829.js";import{u as D}from"./use-toast.fb52de5d.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{k as j}from"./preact.module.7b19fc78.js";import{u as J}from"./index.c54070cf.js";import{a as K}from"./team.eb0a88e7.js";import{g as L,s as O}from"./browser.bcc09af3.js";import{E as H}from"./external-link.a7a2cda9.js";import{u as Q}from"./use-auth.13ac07ad.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function A(c){const{resourceId:r,member:d,resourceType:m,teamId:n,onClose:l}=c,o=E(null),i=E(null),[f,s]=p(),[x,a]=p(!0),v=D();let t="https://roadmap.sh";m==="roadmap"?t+=`/${r}.json`:t+=`/best-practices/${r}.json`;async function u(g,$,w,k){const{error:P,response:I}=await _(`https://api.roadmap.sh/v1-get-member-resource-progress/${g}/${$}?resourceType=${w}&resourceId=${k}`);if(P||!I){v.error(P?.message||"Failed to get member progress");return}return s(I),I}async function y(g){const w=await(await fetch(g)).json(),k=await B(w,{fontURL:"/fonts/balsamiq.woff2"});o.current?.replaceChildren(k)}Y("Escape",()=>{l()}),V(i,()=>{l()}),M(()=>{!o.current||!t||!r||!m||!n||Promise.all([y(t),u(n,d._id,m,r)]).then(([g,$={}])=>{const{removed:w=[],done:k=[],learning:P=[],skipped:I=[]}=$;k.forEach(b=>T(b,"done")),P.forEach(b=>T(b,"learning")),I.forEach(b=>T(b,"skipped")),w.forEach(b=>T(b,"removed"))}).catch(g=>{console.error(g),v.error(g?.message||"Something went wrong. Please try again!")}).finally(()=>{a(!1)})},[]);const h=d.progress.find(g=>g.resourceId===r),N=h?.done||0,G=h?.learning||0,S=h?.skipped||0,C=h?.total||0,R=Math.round(N/C*100);return e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:i,class:"popup-body relative rounded-lg bg-white shadow",children:[e("div",{className:"p-4",children:[e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[d.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",d.name,"'s progress."," ",e("a",{target:"_blank",href:`/${r}?t=${n}`,className:"text-blue-600 underline",children:"View your progress"}),"."]}),e("p",{className:"block text-gray-500 md:hidden",children:["View your progress ",e("a",{target:"_blank",href:`/${r}?t=${n}`,className:"text-blue-600 underline",children:"on the roadmap page."})]})]}),e("p",{class:"-mx-4 mb-3 flex items-center justify-start border-b border-t py-2 text-sm sm:hidden px-4",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:R}),"% Done"]}),e("span",{children:[e("span",{children:N})," of ",e("span",{children:C})," done"]})]}),e("p",{class:"-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:R}),"% Done"]}),e("span",{children:[e("span",{children:N})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-learning":"",children:G})," in progress"]}),S>0&&e(j,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-skipped":"",children:S})," ","skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-total":"",children:C})," Total"]})]})]}),e("div",{ref:o,className:"px-4 pb-2"}),x&&e("div",{class:"flex w-full justify-center",children:e(F,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e("button",{type:"button",className:"popup-close absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 sm:hidden",onClick:l,children:[e("img",{src:q,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}function W(c){const{member:r,teamId:d,isMyProgress:m=!1}=c,n=r?.progress?.sort((s,x)=>x.done-s.done),[l,o]=p(null),[i,f]=p(!1);return e(j,{children:[l&&e(A,{member:r,teamId:d,resourceId:l,resourceType:"roadmap",onClose:()=>{o(null)}}),e("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e("img",{src:r.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${r.avatar}`:"/images/default-avatar.png",alt:r.name||"",className:"h-8 w-8 rounded-full"}),e("div",{className:"inline-grid w-full",children:[!m&&e("h3",{className:"truncate font-medium",children:r.name}),m&&e("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e("h3",{className:"truncate font-medium",children:r.name}),e("span",{className:"rounded-md bg-red-500 text-center py-0.5 text-xs text-white",children:"You"})]}),e("p",{className:"truncate text-sm text-gray-500",children:r.email})]})]}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(i?n:n.slice(0,4)).map(s=>e("button",{onClick:()=>o(s.resourceId),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e("span",{className:"inline-grid",children:e("span",{className:"truncate",children:s.resourceTitle})}),e("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[s.done," / ",s.total]})]}),e("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${s.done/s.total*100}%`}})]},s.resourceId)),n.length>4&&!i&&e("button",{onClick:()=>f(!0),className:"text-sm text-gray-400 underline",children:["+ ",n.length-4," more"]}),i&&e("button",{onClick:()=>f(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),n.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},r._id)]})}function X(c){const{members:r,resourceTitle:d,resourceId:m}=c.roadmap,{t:n}=L(),[l,o]=p(!1),[i,f]=p(null),[s,x]=p(null);return e(j,{children:[i&&e(A,{member:s,teamId:n,resourceId:i,resourceType:"roadmap",onClose:()=>{f(null),x(null)}}),e("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e("div",{className:"flex items-center gap-3 border-b p-3",children:e("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e("h3",{className:"truncate font-medium",children:d}),e("a",{href:`/${m}?t=${n}`,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e("img",{alt:"link",src:H,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(l?r:r.slice(0,4)).map(a=>a.progress?e("button",{className:"group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",onClick:()=>{f(a?.progress?.resourceId),x(a.member)},children:[e("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e("span",{className:"inline-grid grid-cols-[20px_auto] gap-2",children:[e("img",{src:a.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${a.member.avatar}`:"/images/default-avatar.png",alt:a.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e("span",{className:"truncate",children:a?.member?.name})]}),e("span",{className:"shrink-0 text-xs text-gray-400",children:[a?.progress?.done," / ",a?.progress?.total]})]}),e("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${a?.progress?.done/a?.progress?.total*100}%`}})]},a?.member._id):null),r.length>4&&!l&&e("button",{onClick:()=>o(!0),className:"text-sm text-gray-400 underline",children:["+ ",r.length-4," more"]}),l&&e("button",{onClick:()=>o(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),r.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})]})}const Z=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function we(){const{teamId:c}=U(),{gb:r}=L(),[d,m]=p(!0),n=D(),l=J(K),o=Q(),[i,f]=p([]),[s,x]=p(r||"member");async function a(){const{response:t,error:u}=await _(`https://api.roadmap.sh/v1-get-team-progress/${c}`);if(u||!t){n.error(u?.message||"Failed to get team progress");return}f(t.sort((y,h)=>y.email===o?.email?-1:h.email===o?.email?1:0))}if(M(()=>{c&&a().finally(()=>{z.set(""),m(!1)})},[c]),d)return null;if(!c){window.location.href="/";return}M(()=>{s&&O({gb:s})},[s]);const v=[];for(const t of l?.roadmaps||[]){const u=[];for(const y of i){const h=y.progress.find(N=>N.resourceId===t);h&&u.push({member:y,progress:h})}u.length&&v.push({resourceId:t,resourceTitle:u?.[0].progress?.resourceTitle||"",resourceType:"roadmap",members:u})}return e("div",{children:[e("div",{className:"flex items-center gap-2",children:Z.map(t=>e("button",{className:`rounded-md border p-1 px-2 text-sm ${s===t.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>x(t.value),children:t.label}))}),e("div",{className:"mt-6",children:[s==="roadmap"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:v.map(t=>e(X,{roadmap:t},t.resourceId))}),s==="member"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:i.map(t=>e(W,{teamId:c,member:t,isMyProgress:t?.email===o?.email}))})]})]})}export{we as TeamProgressPage};
