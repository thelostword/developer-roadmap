import{g as E}from"./browser.bcc09af3.js";import{h as l,_ as M,p as _}from"./hooks.module.7cc4e70a.js";import{d as S,a as A}from"./http.82ebf0f1.js";import{p as C}from"./page.c1a8a472.js";import{E as j}from"./external-link.a7a2cda9.js";import{S as P,U as D}from"./SearchSelector.9d6b6d2c.js";import{u as L}from"./use-outside-click.85d1a62f.js";import{C as U}from"./CheckIcon.ecb36f9c.js";import{S as z}from"./Spinner.95905af5.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{k as T}from"./preact.module.7b19fc78.js";import{u as Y}from"./index.c54070cf.js";import{a as B}from"./team.12f2469e.js";import{u as G}from"./use-toast.fb52de5d.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./index.es.ebad3893.js";import"./resource-progress.b09662c1.js";/* empty css                       */import"./use-keydown.41d75069.js";import"./toast.1fe7142d.js";const O="/_astro/plus.1630ea32.svg";function q(d){const{teamId:u,onMakeChanges:g,onClose:c,allRoadmaps:y,availableRoadmaps:w,setResourceConfigs:b}=d,[i,f]=l(""),[a,v]=l(!1),[n,m]=l(""),h=M(null);async function k(s){if(!u)return;v(!0);const{error:p,response:R}=await S(`https://api.roadmap.sh/v1-update-team-resource-config/${u}`,{teamId:u,resourceId:s,resourceType:"roadmap",removed:[]});if(p||!R){f(p?.message||"Error adding roadmap");return}b(R)}L(h,()=>{c()});const N=y.find(s=>s.id===n)?.title;return e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:h,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[a&&e(T,{children:e("div",{class:"flex items-center justify-center gap-2 py-8",children:[e(z,{isDualRing:!1,className:"h-4 w-4"}),e("h2",{className:"font-medium",children:"Loading..."})]})}),!a&&!i&&n&&e("div",{className:"text-center",children:[e(U,{additionalClasses:"h-10 w-10 mx-auto opacity-20 mb-3 mt-4"}),e("h3",{class:"mb-1.5 text-2xl font-medium",children:[N," Added"]}),e("p",{className:"mb-4 text-sm leading-none text-gray-400",children:[e("button",{onClick:()=>g(n),className:"underline underline-offset-2 hover:text-gray-900",children:"Click here"})," ","to make changes to the roadmap."]}),e("div",{class:"flex items-center gap-2",children:[e("button",{onClick:c,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Done"}),e("button",{onClick:()=>{m(""),f(""),v(!1)},type:"button",class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white",children:"+ Add More"})]})]}),!a&&i&&e(T,{children:[e("h3",{class:"mb-1.5 text-2xl font-medium",children:"Error"}),e("p",{className:"mb-3 text-sm leading-none text-red-400",children:i}),e("div",{class:"flex items-center gap-2",children:e("button",{onClick:c,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Cancel"})})]}),!a&&!i&&!n&&e(T,{children:[e("h3",{class:"mb-1.5 text-2xl font-medium",children:"Add Roadmap"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400",children:"Search and add a roadmap"}),e(P,{options:w.map(s=>({value:s.id,label:s.title})),onSelect:s=>{const p=s.value;k(p).finally(()=>{v(!1),m(p)})},inputClassName:"mt-2 mb-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Search for roadmap"}),e("div",{class:"flex items-center gap-2",children:e("button",{onClick:c,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Cancel"})})]})]})})})}function pe(){const{t:d}=E(),u=Y(B),g=G(),[c,y]=l(""),[w,b]=l(!1),[i,f]=l(""),[a,v]=l(),[n,m]=l([]),[h,k]=l([]);async function N(){const{error:t,response:r}=await A("/pages.json");if(t){g.error(t.message||"Something went wrong");return}if(!r)return[];const o=r.filter(x=>x.group==="Roadmaps").sort((x,I)=>x.title==="Android"?1:x.title.localeCompare(I.title));return k(o),r}async function s(t){const{response:r,error:o}=await A(`https://api.roadmap.sh/v1-get-team/${t}`);if(o||!r){g.error("Error loading team"),window.location.href="/account";return}v(r)}async function p(t){const{error:r,response:o}=await A(`https://api.roadmap.sh/v1-get-team-resource-config/${t}`);if(r||!Array.isArray(o)){console.error(r);return}m(o)}_(()=>{d&&Promise.all([s(d),p(d),N()]).finally(()=>{C.set("")})},[d]);async function R(t){if(!a?._id)return;C.set("Deleting roadmap from team");const{error:r,response:o}=await S(`https://api.roadmap.sh/v1-delete-team-resource-config/${a._id}`,{resourceId:t,resourceType:"roadmap"});if(r||!o){g.error(r?.message||"Something went wrong");return}g.success("Roadmap removed"),m(o)}async function $(t){C.set("Removing roadmap"),R(t).finally(()=>{C.set("")})}return a?e("div",{children:[w&&e(q,{onMakeChanges:t=>{f(t),b(!1)},teamId:a?._id,setResourceConfigs:m,allRoadmaps:h,availableRoadmaps:h.filter(t=>!n.find(o=>o.resourceId===t.id)),onClose:()=>b(!1)}),e("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[i&&e(D,{onClose:()=>f(""),resourceId:i,resourceType:"roadmap",teamId:a?._id,setTeamResourceConfig:m,defaultRemovedItems:n.find(t=>t.resourceId===i)?.removed||[]}),n.map(t=>{const{resourceId:r,removed:o}=t,x=h.find(I=>I.id===r)?.title||"...";return e("div",{className:"flex flex-col items-start rounded-md border border-gray-300",children:[e("div",{className:"w-full px-3 py-4",children:[e("a",{href:`/${r}?t=${d}`,className:"group mb-0.5 flex items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:[x,e("img",{alt:"link",src:j,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})]}),o.length>0?e("span",{className:"text-xs leading-none text-gray-900",children:[o.length," topic",o.length>1?"s":""," removed"]}):e("span",{className:"text-xs italic leading-none text-gray-400/60",children:"No changes made .."})]}),u&&e("div",{className:"flex w-full justify-between pt-2 pb-3 px-3",children:[e("button",{type:"button",className:"text-xs text-gray-500 underline hover:text-black focus:outline-none",onClick:()=>{y(""),f(r)},children:"Customize"}),c!==r&&e("button",{type:"button",className:"text-xs text-red-500 underline hover:text-black focus:outline-none disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:text-red-500",disabled:n.length===1,onClick:()=>y(r),title:n.length===1?"You must have at least one roadmap.":"Delete roadmap from team",children:"Remove"}),c===r&&e("span",{className:"text-xs",children:["Are you sure?"," ",e("button",{onClick:()=>$(r),className:"mx-0.5 text-red-500 underline underline-offset-1",children:"Yes"})," ",e("button",{onClick:()=>y(""),className:"text-red-500 underline underline-offset-1",children:"No"})]})]})]})}),u&&e("button",{onClick:()=>b(!0),className:"group flex min-h-[110px] flex-col items-center justify-center rounded-md border border-dashed border-gray-300 transition-colors hover:border-gray-600 hover:bg-gray-50",children:[e("img",{alt:"add",src:O,className:"mb-1 h-6 w-6 opacity-20 transition-opacity group-hover:opacity-100"}),e("span",{className:"text-sm text-gray-400 transition-colors focus:outline-none group-hover:text-black",children:"Add Roadmap"})]})]})]}):null}export{pe as TeamRoadmaps};
