import{a as w,T as L}from"./jwt.f0e0aa9c.js";import{h as $,a as C}from"./http.82ebf0f1.js";async function P(o){const{topicId:e,resourceType:r,resourceId:s}=o,{done:n=[]}=await g(r,s)||{};return n?.includes(e)}async function I(o){const{topicId:e,resourceType:r,resourceId:s}=o,n=await g(r,s);return n?.done?.includes(e)?"done":n?.learning?.includes(e)?"learning":n?.skipped?.includes(e)?"skipped":"pending"}async function M(o,e){const{topicId:r,resourceType:s,resourceId:n}=o,{response:a,error:l}=await $("https://api.roadmap.sh/v1-update-resource-progress",{topicId:r,resourceType:s,resourceId:n,progress:e});if(l||!a?.done||!a?.learning)throw new Error(l?.message||"Something went wrong");return y(s,n,a.done,a.learning,a.skipped),a}async function g(o,e){if(!w.get(L))return{done:[],learning:[],skipped:[]};const r=`${o}-${e}-progress`,s=`${o}-${e}-favorite`,n=localStorage.getItem(s),a=JSON.parse(n||"0")===1,l=localStorage.getItem(r),t=JSON.parse(l||"null"),i=t?.timestamp,d=new Date().getTime()-parseInt(i||"0",10)>15*60*1e3;return!t||d?x(o,e):(window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:o,resourceId:e,isFavorite:a}})),t)}async function x(o,e){const{response:r,error:s}=await C("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:o,resourceId:e});return s||!r?(console.error(s),{done:[],learning:[],skipped:[]}):(y(o,e,r?.done||[],r?.learning||[],r?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:o,resourceId:e,isFavorite:r.isFavorite}})),r)}function y(o,e,r,s,n){localStorage.setItem(`${o}-${e}-progress`,JSON.stringify({done:r,learning:s,skipped:n,timestamp:new Date().getTime()}))}function u(o,e){const r=e==="learning",s=e==="skipped",n=e==="done",a=e==="removed",l=[];document.querySelectorAll(`[data-group-id$="-${o}"]`).forEach(t=>{const i=t?.dataset?.groupId||"";new RegExp(`^\\d+-${o}$`).test(i)&&l.push(t)}),document.querySelectorAll(`[data-group-id="${o}"]`).forEach(t=>{l.push(t)}),document.querySelectorAll(`[data-group-id="check:${o}"]`).forEach(t=>{l.push(t)}),l.forEach(t=>{n?(t.classList.add("done"),t.classList.remove("learning","skipped")):r?(t.classList.add("learning"),t.classList.remove("done","skipped")):s?(t.classList.add("skipped"),t.classList.remove("done","learning")):a?(t.classList.add("removed"),t.classList.remove("done","learning","skipped")):t.classList.remove("done","skipped","learning","removed")})}function N(){const o=document.querySelectorAll(".clickable-group");for(const e of o)e.classList.remove("done","skipped","learning","removed")}async function D(o,e){const{done:r=[],learning:s=[],skipped:n=[]}=await g(o,e)||{};r.forEach(a=>{u(a,"done")}),s.forEach(a=>{u(a,"learning")}),n.forEach(a=>{u(a,"skipped")}),R()}function R(){const o=document.querySelectorAll("[data-progress-nums-container]"),e=document.querySelectorAll("[data-progress-nums]");if(o.length===0||e.length===0)return;const r=document.querySelectorAll(".clickable-group").length,s=document.querySelectorAll('[data-group-id^="ext_link:"]').length,n=document.querySelectorAll('[data-group-id^="json:"]').length,a=document.querySelectorAll('[data-group-id^="check:"]').length,l=document.querySelectorAll('[data-group-id^="check:"].done').length,t=document.querySelectorAll('[data-group-id^="check:"].learning').length,i=document.querySelectorAll('[data-group-id^="check:"].skipped').length,p=document.querySelectorAll(".clickable-group.removed").length,d=r-s-n-a-p,m=document.querySelectorAll(".clickable-group.done").length-l,A=document.querySelectorAll(".clickable-group.learning").length-t,h=document.querySelectorAll(".clickable-group.skipped").length-i,f=document.querySelectorAll("[data-progress-done]");f.length>0&&f.forEach(c=>c.innerHTML=`${m}`);const k=document.querySelectorAll("[data-progress-learning]");k.length>0&&k.forEach(c=>c.innerHTML=`${A}`);const S=document.querySelectorAll("[data-progress-skipped]");S.length>0&&S.forEach(c=>c.innerHTML=`${h}`);const E=document.querySelectorAll("[data-progress-total]");E.length>0&&E.forEach(c=>c.innerHTML=`${d}`);const q=Math.round((m+h)/d*100),v=document.querySelectorAll("[data-progress-percentage]");v.length>0&&v.forEach(c=>c.innerHTML=`${q}`),o.forEach(c=>c.classList.remove("striped-loader")),e.forEach(c=>{c.classList.remove("opacity-0")})}export{u as a,R as b,N as c,I as g,P as i,D as r,M as u};
