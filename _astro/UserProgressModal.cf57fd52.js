import{j as e}from"./jsx-runtime.391947bd.js";import{r as o}from"./index.ed373d49.js";import{D as J}from"./index.es.ebad3893.js";/* empty css                       */import{u as _}from"./use-outside-click.54b69c89.js";import{u as B}from"./use-keydown.0305ad6b.js";import{a as P}from"./http.64a7434f.js";import{t as y}from"./resource-progress.495f7d07.js";import{C as K}from"./close.bb7a0ac2.js";import{g as O,d as L}from"./browser.cc6a173a.js";import{u as V}from"./use-auth.2b975076.js";import{S as Y}from"./Spinner.cc2f813e.js";import{E as Q}from"./ErrorIcon.206ac592.js";import"./jwt.1b92699e.js";function pe(C){const{resourceId:i,resourceType:u,userId:I,onClose:b}=C,{s:n=I}=O();if(!n)return null;const R=o.useRef(null),w=o.useRef(null),U=V(),[M,$]=o.useState(!!n),[T,A]=o.useState(null),[N,D]=o.useState(),[x,v]=o.useState(!0),[h,S]=o.useState("");let c="https://roadmap.sh";u==="roadmap"?c+=`/${i}.json`:c+=`/best-practices/${i}.json`;async function q(s,t,a){const{error:p,response:m}=await P(`https://api.roadmap.sh/v1-get-user-progress/${s}?resourceType=${t}&resourceId=${a}`);if(p||!m)throw p||new Error("Something went wrong. Please try again!");return m}async function F(s){const{error:t,response:a}=await P(s);if(t||!a)throw t||new Error("Something went wrong. Please try again!");return await J(a,{fontURL:"/fonts/balsamiq.woff2"})}function f(){L("s"),S(""),$(!1),b?b():window.location.reload()}B("Escape",()=>{f()}),_(w,()=>{f()}),o.useEffect(()=>{!c||!i||!u||!n||(v(!0),Promise.all([F(c),q(n,u,i)]).then(([s,t])=>{if(!t||!s)return;const{progress:a}=t,{done:p,learning:m,skipped:H}=a||{done:[],learning:[],skipped:[]};p?.forEach(r=>{y(r,s).forEach(l=>{l.classList.add("done")})}),m?.forEach(r=>{y(r,s).forEach(l=>{l.classList.add("learning")})}),H?.forEach(r=>{y(r,s).forEach(l=>{l.classList.add("skipped")})}),s.querySelectorAll(".clickable-group").forEach(r=>{r.classList.remove("clickable-group")}),s.querySelectorAll("[data-group-id]").forEach(r=>{r.removeAttribute("data-group-id")}),A(s),D(t)}).catch(s=>{S(s?.message||"Something went wrong. Please try again!")}).finally(()=>{v(!1)}))},[n]);const z=N?.user,d=N?.progress,g=d?.total||0,j=d?.done?.length||0,E=Math.round(j/g*100)||0,G=d?.learning?.length||0,k=d?.skipped?.length||0;return U?.id===n?(L("s"),null):M?x||h?e.jsx("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e.jsxs("div",{className:"flex items-center",children:[x&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-6 w-6",isDualRing:!1}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:"Loading user progress..."})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{additionalClasses:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:h})]})]})})})}):e.jsx("div",{id:"user-progress-modal",className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:w,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[z?.name,"'s Progress"]}),e.jsx("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e.jsxs("p",{className:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:E}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:j})," of ",e.jsx("span",{children:g})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${x?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:E}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:j})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:G})," in progress"]}),k>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:k})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:g})," Total"]})]})]}),e.jsx("div",{ref:R,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:T?.outerHTML||""}}),e.jsxs("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:f,children:[e.jsx("img",{alt:"close",src:K.src,className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})}):null}export{pe as UserProgressModal};
