import{g as L}from"./browser.bcc09af3.js";import{_ as $,h as p,p as I}from"./hooks.module.7cc4e70a.js";import{c as E,a as S}from"./http.ae6f811c.js";import{p as N}from"./page.c1a8a472.js";import{E as M}from"./external-link.a7a2cda9.js";import{U as _}from"./UpdateTeamResourceModal.f601685f.js";import{u as j}from"./use-outside-click.85d1a62f.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{k as A}from"./preact.module.7b19fc78.js";import{C as P}from"./CheckIcon.ecb36f9c.js";import{S as z}from"./Spinner.95905af5.js";import{u as O}from"./index.c54070cf.js";import{b as U}from"./team.eb0a88e7.js";import{u as G}from"./use-toast.fb52de5d.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./index.es.ebad3893.js";import"./resource-progress.7a8a770c.js";/* empty css                       */import"./use-keydown.41d75069.js";import"./toast.1fe7142d.js";const Y="/_astro/plus.1630ea32.svg";function B({options:i,onSelect:g,inputClassName:b,searchInputId:h,placeholder:w}){const C=$(null),x=$(null),[c,d]=p(!1),[n,f]=p([]),[s,m]=p(""),[u,v]=p(0);return I(()=>{if(s.length===0){f(i.slice(0,5));return}d(!0);const r=s.trim().toLowerCase(),t=i.filter(y=>y.label.toLowerCase().indexOf(r)!==-1).slice(0,5);f(t),v(0)},[s]),I(()=>{f(i.slice(0,5))},[i]),I(()=>{if(c){const r=t=>{x.current&&!x.current.contains(t.target)&&C.current&&!C.current.contains(t.target)&&(d(!1),m(""),f(i.slice(0,5)))};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}}},[c]),e("div",{className:"relative",children:[e("input",{ref:C,type:"text",id:h,value:s,className:`w-full ${b}`,placeholder:w,autoComplete:"off",onInput:r=>{const t=r.target.value.trim();m(t)},onFocus:()=>{d(!0),f(i.slice(0,5))},onKeyDown:r=>{if(r.key==="ArrowDown"){const t=u<n.length-1;v(t?u+1:0)}else if(r.key==="ArrowUp"){const t=u>0;v(t?u-1:n.length-1)}else if(r.key==="Tab")c&&r.preventDefault();else if(r.key==="Escape")m(""),d(!1);else if(r.key==="Enter"){r.preventDefault();const t=n[u];t&&(g(t),m(""),d(!1))}}}),c&&e("div",{class:"absolute top-full z-50 mt-2 w-full rounded-md bg-gray-100 px-2 py-2",ref:x,children:e("div",{className:"flex flex-col",children:[n.length===0&&e("div",{class:"p-5 text-center text-sm text-gray-400",children:"No results found"}),n.map((r,t)=>e(A,{children:e("button",{type:"button",class:`flex w-full items-center rounded p-2 text-sm ${t===u?"bg-gray-200":""}`,onMouseOver:()=>v(t),onClick:()=>{g(r),m(""),d(!1)},children:r.label})}))]})})]})}function F(i){const{teamId:g,onMakeChanges:b,onClose:h,allRoadmaps:w,availableRoadmaps:C,setResourceConfigs:x}=i,[c,d]=p(""),[n,f]=p(!1),[s,m]=p(""),u=$(null);async function v(t){if(!g)return;f(!0);const{error:y,response:k}=await E(`https://api.roadmap.sh/v1-update-team-resource-config/${g}`,{teamId:g,resourceId:t,resourceType:"roadmap",removed:[]});if(y||!k){d(y?.message||"Error adding roadmap");return}x(k)}j(u,()=>{h()});const r=w.find(t=>t.id===s)?.title;return e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:u,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[n&&e(A,{children:e("div",{class:"flex items-center justify-center gap-2 py-8",children:[e(z,{isDualRing:!1,className:"h-4 w-4"}),e("h2",{className:"font-medium",children:"Loading..."})]})}),!n&&!c&&s&&e("div",{className:"text-center",children:[e(P,{additionalClasses:"h-10 w-10 mx-auto opacity-20 mb-3 mt-4"}),e("h3",{class:"mb-1.5 text-2xl font-medium",children:[r," Added"]}),e("p",{className:"mb-4 text-sm leading-none text-gray-400",children:[e("button",{onClick:()=>b(s),className:"underline underline-offset-2 hover:text-gray-900",children:"Click here"})," ","to make changes to the roadmap."]}),e("div",{class:"flex items-center gap-2",children:[e("button",{onClick:h,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Done"}),e("button",{onClick:()=>{m(""),d(""),f(!1)},type:"button",class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white",children:"+ Add More"})]})]}),!n&&c&&e(A,{children:[e("h3",{class:"mb-1.5 text-2xl font-medium",children:"Error"}),e("p",{className:"mb-3 text-sm leading-none text-red-400",children:c}),e("div",{class:"flex items-center gap-2",children:e("button",{onClick:h,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Cancel"})})]}),!n&&!c&&!s&&e(A,{children:[e("h3",{class:"mb-1.5 text-2xl font-medium",children:"Add Roadmap"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400",children:"Search and add a roadmap"}),e(B,{options:C.map(t=>({value:t.id,label:t.title})),onSelect:t=>{const y=t.value;v(y).finally(()=>{f(!1),m(y)})},inputClassName:"mt-2 mb-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Search for roadmap"}),e("div",{class:"flex items-center gap-2",children:e("button",{onClick:h,type:"button",class:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center hover:bg-gray-300",children:"Cancel"})})]})]})})})}function ue(){const{t:i}=L(),g=O(U),b=G(),[h,w]=p(""),[C,x]=p(!1),[c,d]=p(""),[n,f]=p(),[s,m]=p([]),[u,v]=p([]);async function r(){const{error:a,response:o}=await S("/pages.json");if(a){b.error(a.message||"Something went wrong");return}if(!o)return[];const l=o.filter(R=>R.group==="Roadmaps").sort((R,T)=>R.title==="Android"?1:R.title.localeCompare(T.title));return v(l),o}async function t(a){const{response:o,error:l}=await S(`https://api.roadmap.sh/v1-get-team/${a}`);if(l||!o){b.error("Error loading team"),window.location.href="/account";return}f(o)}async function y(a){const{error:o,response:l}=await S(`https://api.roadmap.sh/v1-get-team-resource-config/${a}`);if(o||!Array.isArray(l)){console.error(o);return}m(l)}I(()=>{i&&Promise.all([t(i),y(i),r()]).finally(()=>{N.set("")})},[i]);async function k(a){if(!n?._id)return;N.set("Deleting roadmap from team");const{error:o,response:l}=await E(`https://api.roadmap.sh/v1-delete-team-resource-config/${n._id}`,{resourceId:a,resourceType:"roadmap"});if(o||!l){b.error(o?.message||"Something went wrong");return}b.success("Roadmap removed"),m(l)}async function D(a){N.set("Removing roadmap"),k(a).finally(()=>{N.set("")})}return n?e("div",{children:[C&&e(F,{onMakeChanges:a=>{d(a),x(!1)},teamId:n?._id,setResourceConfigs:m,allRoadmaps:u,availableRoadmaps:u.filter(a=>!s.find(l=>l.resourceId===a.id)),onClose:()=>x(!1)}),e("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[c&&e(_,{onClose:()=>d(""),resourceId:c,resourceType:"roadmap",teamId:n?._id,setTeamResourceConfig:m,defaultRemovedItems:s.find(a=>a.resourceId===c)?.removed||[]}),s.map(a=>{const{resourceId:o,removed:l}=a,R=u.find(T=>T.id===o)?.title||"...";return e("div",{className:"flex flex-col items-start rounded-md border border-gray-300",children:[e("div",{className:"w-full px-3 py-4",children:[e("a",{href:`/${o}?t=${i}`,className:"group mb-0.5 flex items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:[R,e("img",{alt:"link",src:M,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})]}),l.length>0?e("span",{className:"text-xs leading-none text-gray-900",children:[l.length," topic",l.length>1?"s":""," removed"]}):e("span",{className:"text-xs italic leading-none text-gray-400/60",children:"No changes made .."})]}),g&&e("div",{className:"flex w-full justify-between pt-2 pb-3 px-3",children:[e("button",{type:"button",className:"text-xs text-gray-500 underline hover:text-black focus:outline-none",onClick:()=>{w(""),d(o)},children:"Customize"}),h!==o&&e("button",{type:"button",className:"text-xs text-red-500 underline hover:text-black focus:outline-none disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:text-red-500",disabled:s.length===1,onClick:()=>w(o),title:s.length===1?"You must have at least one roadmap.":"Delete roadmap from team",children:"Remove"}),h===o&&e("span",{className:"text-xs",children:["Are you sure?"," ",e("button",{onClick:()=>D(o),className:"mx-0.5 text-red-500 underline underline-offset-1",children:"Yes"})," ",e("button",{onClick:()=>w(""),className:"text-red-500 underline underline-offset-1",children:"No"})]})]})]})}),g&&e("button",{onClick:()=>x(!0),className:"group flex min-h-[110px] flex-col items-center justify-center rounded-md border border-dashed border-gray-300 transition-colors hover:border-gray-600 hover:bg-gray-50",children:[e("img",{alt:"add",src:Y,className:"mb-1 h-6 w-6 opacity-20 transition-opacity group-hover:opacity-100"}),e("span",{className:"text-sm text-gray-400 transition-colors focus:outline-none group-hover:text-black",children:"Add Roadmap"})]})]})]}):null}export{ue as TeamRoadmaps};
