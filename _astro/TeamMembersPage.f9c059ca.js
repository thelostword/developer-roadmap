import{_ as y,h as i,p as C}from"./hooks.module.7cc4e70a.js";import{b as T,c as R,h as L,d as D,a as $}from"./http.82ebf0f1.js";import{u as I}from"./use-outside-click.85d1a62f.js";import{u as k}from"./use-toast.fb52de5d.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{u as U}from"./use-auth.13ac07ad.js";import{p as w}from"./page.c1a8a472.js";import{S as j}from"./Spinner.95905af5.js";import{u as S}from"./use-team-id.3d0ab368.js";import{R as P}from"./RoleDropdown.0bcc7fe3.js";import{g as E}from"./browser.bcc09af3.js";import{u as _}from"./index.c54070cf.js";import{a as z}from"./team.12f2469e.js";import"./preact.module.7b19fc78.js";import"./jwt.f0e0aa9c.js";import"./toast.1fe7142d.js";import"./index.a98c85f5.js";const B="/_astro/more-vertical.bfff43ef.svg";function O({member:r,onUpdateMember:n,onDeleteMember:m,isDisabled:l=!1}){const d=k(),c=y(null),[u,s]=i(!1),[f,g]=i(!1);I(c,()=>{s(!1)});async function p(){const{response:h,error:o}=await T(`https://api.roadmap.sh/v1-resend-invite/${r.teamId}/${r._id}`,{});if(o||!h){g(!1),d.error(o?.message||"Something went wrong");return}window.location.reload()}const b=[{name:"Delete",handleClick:()=>{m(),s(!1)}},{name:"Update Role",handleClick:()=>{n(),s(!1)}},...["invited"].includes(r.status)?[{name:"Resend Invite",handleClick:p}]:[]];return e("div",{className:"relative",children:[e("button",{disabled:l,onClick:()=>s(!u),className:"ml-2 flex items-center opacity-60 transition-opacity hover:opacity-100 disabled:cursor-not-allowed disabled:opacity-30",children:e("img",{alt:"menu",src:B,className:"h-4 w-4"})}),u&&e("div",{ref:c,className:"align-right absolute right-0 top-full z-50 mt-1 w-32 rounded-md bg-slate-800 px-2 py-2 text-white shadow-md",children:e("ul",{children:b.map((h,o)=>e("li",{children:e("button",{onClick:h.handleClick,disabled:f,className:"flex w-full cursor-pointer items-center rounded p-2 text-sm font-medium text-slate-100 hover:bg-slate-700",children:h.name})},o))})})]})}function A(r){const n=k(),[m,l]=i(!1),{teamId:d}=r;async function c(){l(!0);const{response:u,error:s}=await R(`https://api.roadmap.sh/v1-leave-team/${d}`,{});if(s||!u){l(!1),n.error(s?.message||"Something went wrong");return}window.location.href="/account"}return e("button",{disabled:m,onClick:c,className:"bg-gray-50 text-red-600 text-sm font-medium px-2 leading-none py-1.5 rounded-md border border-gray-200 h-7 flex items-center justify-center min-w-[95px]",children:m?e(j,{isDualRing:!1}):"Leave team"})}function F(r){const{onClose:n,onInvited:m}=r,l=y(null),d=y(null),[c,u]=i("member"),[s,f]=i(""),[g,p]=i(!1),[b,h]=i(""),{teamId:o}=S();C(()=>{d?.current?.focus()},[]);const x=async a=>{a.preventDefault(),p(!0),h("");const{response:N,error:v}=await L(`https://api.roadmap.sh/v1-invite-member/${o}`,{email:s,role:c});if(v||!N){p(!1),h(v?.message||"Something went wrong");return}p(!1),t(),m()},t=()=>{p(!1),h(""),n()};return I(l,t),e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:l,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e("h3",{class:"mb-1.5 text-xl sm:text-2xl font-medium",children:"Invite Member"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400 hidden sm:block",children:"Enter the email and role below to invite a member."}),e("form",{onSubmit:x,children:[e("div",{className:"mt-0 sm:mt-4 my-4 flex flex-col gap-2",children:[e("input",{ref:d,type:"email",name:"invite-member",id:"invite-member",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Enter email address",required:!0,autoFocus:!0,value:s,onInput:a=>f(a.target.value)}),e("div",{className:"flex h-[42px] w-full flex-col",children:e(P,{className:"h-full w-full",selectedRole:c,setSelectedRole:u})}),b&&e("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:b})]}),e("div",{className:"flex items-center gap-2",children:[e("button",{type:"button",disabled:g,onClick:t,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e("button",{type:"submit",disabled:g||!s,class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:g?"Please wait ..":"Invite"})]})]})]})})})}function Y(r){const{onClose:n,onUpdated:m,member:l}=r,d=y(null),[c,u]=i(l.role),[s,f]=i(!1),[g,p]=i(""),{teamId:b}=S(),h=async x=>{x.preventDefault(),f(!0),p("");const{response:t,error:a}=await D(`https://api.roadmap.sh/v1-update-member-role/${b}/${l._id}`,{role:c});if(a||!t){f(!1),p(a?.message||"Something went wrong");return}f(!1),m()},o=()=>{f(!1),p(""),n()};return I(d,o),e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:d,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e("h3",{class:"mb-1.5 text-xl sm:text-2xl font-medium",children:"Update Role"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400 hidden sm:block",children:"Select the role to update for this member"}),e("form",{onSubmit:h,children:[e("div",{className:"mt-0 sm:mt-4 my-4 flex flex-col gap-2",children:[e("span",{className:"mt-2 block w-full rounded-md bg-gray-100 p-2",children:l.invitedEmail}),e("div",{className:"flex h-[42px] w-full flex-col",children:e(P,{className:"h-full w-full",selectedRole:c,setSelectedRole:u})}),g&&e("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:g})]}),e("div",{className:"flex items-center gap-2",children:[e("button",{type:"button",disabled:s,onClick:o,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e("button",{type:"submit",disabled:s||!c,class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:s?"Please wait ..":"Update Role"})]})]})]})})})}function M({role:r}){return e("span",{className:`rounded-full px-2 py-0.5 text-xs capitalize ${["admin"].includes(r)?"bg-blue-100 text-blue-700 ":"bg-gray-100 text-gray-700 "} ${["manager"].includes(r)?"bg-green-100 text-green-700":""}`,children:r})}function oe(){const{t:r}=E(),n=k(),m=_(z),[l,d]=i(),[c,u]=i(!1),[s,f]=i([]),[g,p]=i(),b=U();async function h(){const{response:t,error:a}=await $(`https://api.roadmap.sh/v1-get-team/${r}`);if(a||!t){n.error(a?.message||"Something went wrong");return}t&&p(t)}async function o(){const{response:t,error:a}=await $(`https://api.roadmap.sh/v1-get-team-member-list/${r}`);if(a||!t){n.error(a?.message||"Failed to load team member list");return}f(t)}C(()=>{r&&Promise.all([h(),o()]).finally(()=>{w.set("")})},[r]);async function x(t,a){w.set("Deleting member");const{response:N,error:v}=await R(`https://api.roadmap.sh/v1-delete-member/${t}/${a}`,{});if(v||!N){n.error(v?.message||"Something went wrong");return}n.success("Member has been deleted"),await o()}return e("div",{children:[l&&e(Y,{member:l,onUpdated:()=>{w.set("Refreshing members"),o().finally(()=>{w.set("")}),d(void 0),n.success("Member has been updated")},onClose:()=>{d(void 0)}}),c&&e(F,{onInvited:()=>{n.success("Invite sent"),o().then(()=>null),u(!1)},onClose:()=>{u(!1)}}),e("div",{children:e("div",{className:"rounded-b-sm rounded-t-md border",children:[e("div",{className:"flex items-center justify-between gap-2 border-b p-3",children:[e("p",{className:"hidden text-sm sm:block",children:[s.length," people in the team."]}),e("p",{className:"block text-sm sm:hidden",children:[s.length," members"]}),e(A,{teamId:g?._id})]}),s.map((t,a)=>e("div",{className:`flex items-center justify-between gap-2 p-3 ${a===0?"":"border-t"} ${t.status==="invited"?"bg-gray-50":""}`,children:[e("div",{className:"flex items-center gap-3",children:[e("img",{src:t.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${t.avatar}`:"/images/default-avatar.png",alt:t.name||"",className:"hidden h-10 w-10 rounded-full sm:block"}),e("div",{children:[e("span",{class:"mb-1 block sm:hidden",children:e(M,{role:t.role})}),e("div",{className:"flex items-center",children:[e("h3",{className:"flex items-center font-medium",children:[t.name,t.userId===b?.id&&e("span",{className:"ml-2 hidden text-xs font-normal text-blue-500 sm:inline",children:"You"})]}),e("div",{className:"ml-2 flex items-center gap-0.5",children:[t.status==="invited"&&e("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700",children:"Invited"}),t.status==="rejected"&&e("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700",children:"Rejected"})]})]}),e("p",{className:"text-sm text-gray-500",children:t.invitedEmail})]})]}),e("div",{className:"flex items-center text-sm",children:[e("span",{class:"hidden sm:block",children:e(M,{role:t.role})}),m&&e(O,{onDeleteMember:()=>{x(r,t._id).finally(()=>{w.set("")})},isDisabled:t.userId===b?.id,onUpdateMember:()=>{d(t)},member:t})]})]}))]})}),m&&e("div",{className:"mt-4",children:e("button",{disabled:s.length>=25,onClick:()=>u(!0),className:"block w-full rounded-md border border-dashed border-gray-300 py-2 text-sm transition-colors hover:border-gray-600 hover:bg-gray-50 focus:outline-0",children:"+ Invite Member"})}),s.length>=25&&m&&e("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:"You have reached the maximum number of members in a team. Please reach out to us if you need more."})]})}export{oe as TeamMembersPage};
