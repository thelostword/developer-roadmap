import{_ as L,h as a,p as J}from"./hooks.module.588e47ed.js";import{D as B}from"./index.es.ebad3893.js";/* empty css                       */import{u as K}from"./use-outside-click.48e5e038.js";import{u as O}from"./use-keydown.6a88dc80.js";import{a as j}from"./http.82ebf0f1.js";import{t as b}from"./resource-progress.069a7d3a.js";import{C as V}from"./close.3a539829.js";import{g as Y,d as C}from"./browser.bcc09af3.js";import{u as F}from"./use-auth.13ac07ad.js";import{S as Q}from"./Spinner.5c883e87.js";import{E as W}from"./ErrorIcon.bc06c552.js";import{o as e}from"./jsxRuntime.module.c718f406.js";import{k as w}from"./preact.module.ce248672.js";import"./jwt.f0e0aa9c.js";function he(I){const{s:n}=Y(),{resourceId:i,resourceType:h}=I,U=L(null),v=L(null),$=F();if(!n||$?.id===n)return C("s"),null;const[M,R]=a(!!n),[T,A]=a(null),[k,D]=a(),[u,E]=a(!0),[f,S]=a("");let c="https://roadmap.sh";h==="roadmap"?c+=`/${i}.json`:c+=`/best-practices/${i}.json`;async function q(r,t,o){const{error:p,response:m}=await j(`https://api.roadmap.sh/v1-get-user-progress/${r}?resourceType=${t}&resourceId=${o}`);if(p||!m)throw p||new Error("Something went wrong. Please try again!");return m}async function _(r){const{error:t,response:o}=await j(r);if(t||!o)throw t||new Error("Something went wrong. Please try again!");return await B(o,{fontURL:"/fonts/balsamiq.woff2"})}function g(){C("s"),S(""),R(!1)}O("Escape",()=>{g()}),K(v,()=>{g()}),J(()=>{!c||!i||!h||(E(!0),Promise.all([_(c),q(n,h,i)]).then(([r,t])=>{if(!t||!r)return;const{progress:o}=t,{done:p,learning:m,skipped:H}=o||{done:[],learning:[],skipped:[]};p?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("done")})}),m?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("learning")})}),H?.forEach(s=>{b(s,r).forEach(l=>{l.classList.add("skipped")})}),r.querySelectorAll(".clickable-group").forEach(s=>{s.classList.remove("clickable-group")}),r.querySelectorAll("[data-group-id]").forEach(s=>{s.removeAttribute("data-group-id")}),A(r),D(t)}).catch(r=>{S(r?.message||"Something went wrong. Please try again!")}).finally(()=>{E(!1)}))},[n]);const z=k?.user,d=k?.progress,x=d?.total||0,y=d?.done?.length||0,N=Math.round(y/x*100)||0,G=d?.learning?.length||0,P=d?.skipped?.length||0;return M?u||f?e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto flex h-full w-full items-center justify-center",children:e("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e("div",{className:"flex items-center",children:[u&&e(w,{children:[e(Q,{className:"h-6 w-6",isDualRing:!1}),e("span",{className:"ml-3 text-lg font-semibold",children:"Loading user progress..."})]}),f&&e(w,{children:[e(W,{additionalClasses:"h-6 w-6 text-red-500"}),e("span",{className:"ml-3 text-lg font-semibold",children:f})]})]})})})}):e("div",{id:"user-progress-modal",class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:v,class:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e("div",{className:"p-4",children:[e("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[z?.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e("p",{class:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:N}),"% Done"]}),e("span",{children:[e("span",{children:y})," of ",e("span",{children:x})," done"]})]}),e("p",{class:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${u?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:N}),"% Done"]}),e("span",{children:[e("span",{children:y})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:G})," in progress"]}),P>0&&e(w,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:P})," skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{children:x})," Total"]})]})]}),e("div",{ref:U,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:T?.outerHTML||""}}),e("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:g,children:[e("img",{alt:"close",src:V,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})}):null}export{he as UserProgressModal};
