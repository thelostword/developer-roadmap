import{a as L,T as $}from"./jwt.f0e0aa9c.js";import{h as w,a as T}from"./http.20668c64.js";async function I(r){const{topicId:e,resourceType:o,resourceId:c}=r,{done:t=[]}=await d(o,c)||{};return t?.includes(e)}async function R(r){const{topicId:e,resourceType:o,resourceId:c}=r,t=await d(o,c);return t?.done?.includes(e)?"done":t?.learning?.includes(e)?"learning":t?.skipped?.includes(e)?"skipped":"pending"}async function M(r,e){const{topicId:o,resourceType:c,resourceId:t}=r,{response:s,error:n}=await w("https://api.roadmap.sh/v1-update-resource-progress",{topicId:o,resourceType:c,resourceId:t,progress:e});if(n||!s?.done||!s?.learning)throw new Error(n?.message||"Something went wrong");return E(c,t,s.done,s.learning,s.skipped),s}async function d(r,e){if(!L.get($))return{done:[],learning:[],skipped:[]};const o=`${r}-${e}-progress`,c=localStorage.getItem(o),t=JSON.parse(c||"null"),s=t?.timestamp,l=new Date().getTime()-parseInt(s||"0",10)>15*60*1e3;return!t||l?x(r,e):t}async function x(r,e){const{response:o,error:c}=await T("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:r,resourceId:e});return c||!o?(console.error(c),{done:[],learning:[],skipped:[]}):(E(r,e,o?.done||[],o?.learning||[],o?.skipped||[]),o)}function E(r,e,o,c,t){localStorage.setItem(`${r}-${e}-progress`,JSON.stringify({done:o,learning:c,skipped:t,timestamp:new Date().getTime()}))}function i(r,e){const o=e==="learning",c=e==="skipped",t=e==="done",s=[];document.querySelectorAll(`[data-group-id$="-${r}"]`).forEach(n=>{const l=n?.dataset?.groupId||"";new RegExp(`^\\d+-${r}$`).test(l)&&s.push(n)}),document.querySelectorAll(`[data-group-id="${r}"]`).forEach(n=>{s.push(n)}),document.querySelectorAll(`[data-group-id="check:${r}"]`).forEach(n=>{s.push(n)}),s.forEach(n=>{t?(n.classList.add("done"),n.classList.remove("learning","skipped")):o?(n.classList.add("learning"),n.classList.remove("done","skipped")):c?(n.classList.add("skipped"),n.classList.remove("done","learning")):n.classList.remove("done","skipped","learning")})}async function b(r,e){const{done:o=[],learning:c=[],skipped:t=[]}=await d(r,e)||{};o.forEach(s=>{i(s,"done")}),c.forEach(s=>{i(s,"learning")}),t.forEach(s=>{i(s,"skipped")}),C()}function C(){const r=document.querySelectorAll("[data-progress-nums-container]"),e=document.querySelectorAll("[data-progress-nums]");if(r.length===0||e.length===0)return;const o=document.querySelectorAll(".clickable-group").length,c=document.querySelectorAll('[data-group-id^="ext_link:"]').length,t=document.querySelectorAll('[data-group-id^="json:"]').length,s=document.querySelectorAll('[data-group-id^="check:"]').length,n=document.querySelectorAll('[data-group-id^="check:"].done').length,l=document.querySelectorAll('[data-group-id^="check:"].learning').length,u=document.querySelectorAll('[data-group-id^="check:"].skipped').length,p=o-c-t-s,g=document.querySelectorAll(".clickable-group.done").length-n,A=document.querySelectorAll(".clickable-group.learning").length-l,h=document.querySelectorAll(".clickable-group.skipped").length-u,f=document.querySelectorAll("[data-progress-done]");f.length>0&&f.forEach(a=>a.innerHTML=`${g}`);const m=document.querySelectorAll("[data-progress-learning]");m.length>0&&m.forEach(a=>a.innerHTML=`${A}`);const k=document.querySelectorAll("[data-progress-skipped]");k.length>0&&k.forEach(a=>a.innerHTML=`${h}`);const y=document.querySelectorAll("[data-progress-total]");y.length>0&&y.forEach(a=>a.innerHTML=`${p}`);const q=Math.round((g+h)/p*100),S=document.querySelectorAll("[data-progress-percentage]");S.length>0&&S.forEach(a=>a.innerHTML=`${q}`),r.forEach(a=>a.classList.remove("striped-loader")),e.forEach(a=>{a.classList.remove("opacity-0")})}export{C as a,b,R as g,I as i,i as r,M as u};
